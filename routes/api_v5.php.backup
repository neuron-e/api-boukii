<?php

use App\V5\Modules\Season\Controllers\SeasonController;
use App\V5\Modules\Booking\Controllers\BookingController;
use Illuminate\Support\Facades\Route;

/*
|--------------------------------------------------------------------------
| V5 API Routes
|--------------------------------------------------------------------------
|
| API routes for Boukii V5. These routes are loaded by the RouteServiceProvider
| and all routes will be assigned to the "api" middleware group.
|
*/

Route::prefix('v5')->name('v5.')->middleware([
    'api',
    'auth:sanctum',
    'v5.logging',
    'season.context',
    'season.permission'
])->group(function () {
    
    /*
    |--------------------------------------------------------------------------
    | Season Routes
    |--------------------------------------------------------------------------
    */
    // TEMPORARILY DISABLED - OLD V5 SEASON ROUTES CONFLICTING WITH NEW V5 ROUTES
    // Route::prefix('seasons')->name('seasons.')->group(function () {
    //     
    //     // Get current season (before resource routes to avoid conflict)
    //     Route::get('current', [SeasonController::class, 'current'])
    //         ->name('current');

    //     // Season resource routes (CRUD)
    //     Route::get('/', [SeasonController::class, 'index'])
    //         ->name('index');
    //     Route::post('/', [SeasonController::class, 'store'])
    //         ->name('store');
    //     Route::get('{id}', [SeasonController::class, 'show'])
    //         ->name('show');
    //     Route::put('{id}', [SeasonController::class, 'update'])
    //         ->name('update');
    //     Route::delete('{id}', [SeasonController::class, 'destroy'])
    //         ->name('destroy');

    //     // Special season operations
    //     Route::post('{id}/close', [SeasonController::class, 'close'])
    //         ->name('close');
    //     Route::post('{id}/clone', [SeasonController::class, 'clone'])
    //         ->name('clone');
    // });

    /*
    |--------------------------------------------------------------------------
    | Booking Routes
    |--------------------------------------------------------------------------
    */
    Route::prefix('bookings')->name('bookings.')->group(function () {
        
        // Special endpoints (before resource routes to avoid conflicts)
        Route::get('stats', [BookingController::class, 'stats'])
            ->name('stats');
        Route::get('search', [BookingController::class, 'search'])
            ->name('search');
        Route::get('upcoming', [BookingController::class, 'upcoming'])
            ->name('upcoming');
        Route::get('attention', [BookingController::class, 'attention'])
            ->name('attention');

        // Booking resource routes (CRUD)
        Route::get('/', [BookingController::class, 'index'])
            ->name('index');
        Route::post('/', [BookingController::class, 'store'])
            ->name('store');
        Route::get('{id}', [BookingController::class, 'show'])
            ->name('show');
        Route::put('{id}', [BookingController::class, 'update'])
            ->name('update');
        Route::delete('{id}', [BookingController::class, 'destroy'])
            ->name('destroy');

        // Booking status management
        Route::patch('{id}/status', [BookingController::class, 'updateStatus'])
            ->name('update-status');
    });
    
});